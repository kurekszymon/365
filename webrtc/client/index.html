<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
    <title>WebRTC SFU - mediasoup</title>
    <link rel="stylesheet" href="main.css" />
</head>

<body>
    <div id="container">
        <h1><a href="//webrtc.github.io/samples/" title="WebRTC samples homepage">WebRTC</a>
            <span>SFU (mediasoup)</span>
        </h1>

        <p>Connect with others using WebRTC SFU architecture. Enter the same room name to connect with multiple peers.
        </p>

        <div class="box">
            <input type="text" id="roomInput" placeholder="Enter room name..." />
            <button id="joinButton">Join Room</button>
            <div id="status">Waiting to connect...</div>
        </div>

        <div class="videos-grid">
            <!-- Main stage for screen share -->
            <div id="mainStage" class="main-stage hidden">
                <div id="screenShareContainer" class="screen-share-main"></div>
                <!-- Annotation canvas overlay -->
                <canvas id="annotationCanvas" class="annotation-canvas"></canvas>
                <!-- Labels overlay canvas (temporary, fades out) -->
                <canvas id="labelsCanvas" class="labels-canvas"></canvas>
                <!-- Annotation toolbar -->
                <div id="annotationToolbar" class="annotation-toolbar">
                    <button id="drawTool" class="tool-btn active" title="Draw">‚úèÔ∏è</button>
                    <button id="eraserTool" class="tool-btn" title="Eraser">üßπ</button>
                    <input type="color" id="colorPicker" value="#ff0000" title="Color">
                    <input type="range" id="brushSize" min="2" max="20" value="4" title="Brush Size">
                    <button id="clearCanvas" class="tool-btn" title="Clear All">üóëÔ∏è</button>
                    <button id="toggleAnnotations" class="tool-btn" title="Toggle Annotations">üëÜ</button>
                </div>
            </div>
            <!-- Sidebar for participant videos -->
            <div id="participantsSidebar" class="participants-sidebar">
                <div class="local-video-container">
                    <video id="localVideo" playsinline autoplay muted></video>
                    <div class="video-label">You (local)</div>
                </div>
                <div id="remoteVideos"></div>
            </div>
        </div>

        <div class="box">
            <button id="startButton">Start Camera</button>
            <button id="hangupButton">Stop Camera</button>
            <button id="screenShareButton">Share Screen</button>
            <button id="toggleChatButton">üí¨ Chat</button>
        </div>

        <!-- Collapsible Chat Sidebar -->
        <div id="chatSidebar" class="chat-sidebar">
            <div class="chat-sidebar-header">
                <h3>Chat & File Transfer</h3>
                <button id="closeChatButton" class="close-chat-btn">‚úï</button>
            </div>
            <div class="chat-sidebar-content">
                <div id="dcStatus">Chat: not connected</div>
                <div id="chatMessages"></div>
                <div class="chat-input-row">
                    <input type="text" id="chatInput" placeholder="Type a message..." />
                    <button id="sendChatButton">Send</button>
                </div>
                <div class="file-row">
                    <input type="file" id="fileInput" />
                    <button id="sendFileButton">Send File</button>
                </div>
            </div>
        </div>

        <div class="instructions">
            <p><strong>How to use:</strong></p>
            <ol>
                <li>Enter a room name and click "Join Room"</li>
                <li>Click "Start Camera" to enable your camera and microphone</li>
                <li>Share the room name with others to connect</li>
                <li>Multiple participants can join the same room</li>
            </ol>
            <p><em>This uses SFU (Selective Forwarding Unit) architecture via mediasoup for better scalability.</em></p>
        </div>
    </div>

    <script type="module" src="index.ts"></script>
</body>

</html>